node {
  

   env.JAVA_HOME = tool 'JAVA_HOME'
  
   def mvnHome = tool 'M3'
  
  
   env.PATH = "${mvnHome}/bin:${env.JAVA_HOME}/bin:${env.PATH}"

  
 
   stage ('scm') {
    
   git 'git url'
   
   }
 
   
  
   stage ('Compile or build Stage') {
            
            
   sh 'mvn clean compile'
        
   }
    
  

   stage ('Tesing Stage') {
        
        
   sh 'mvn test'
    
   }
     
   
 
   stage ('Package Stage') {
       
   sh 'mvn package'
   
   }  

    
 
   stage("SonarQube analysis") {
          
   withSonarQubeEnv('SonarQube') {
                 
   sh 'mvn sonar:sonar'
              
 }
          
}
      
   

   
    stage ('Distribute binaries to Jfrog Artifactory') { 
    def SERVER_ID = '1' 
    def server = Artifactory.server SERVER_ID
    def uploadSpec = 
    """
    {
    "files": [
        {
            "pattern": "all/target/all-(*).war",
            "target": "libs-snapshots-local/"
        }
      ]
    }
    """
    def buildInfo = Artifactory.newBuildInfo() 
    buildInfo.env.capture = true 
    buildInfo=server.upload(uploadSpec) 
    server.publishBuildInfo(buildInfo) 
}


}

